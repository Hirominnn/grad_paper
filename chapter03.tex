\chapter{分析手法}
\label{chap:method}
\fancyhf{}
\rhead{\thepage}
\lhead{第\ref{chap:method}章　分析手法}
\cfoot{\thepage}
本章では，
事前の知識分類を用いずに生徒の知識獲得を予測し，その過程で抽出された知識分類を分析する手法について説明する．

まず，分析手法全体の流れを概説し，手法全体が３つの要素から構成されることを述べる．
その後，前提として，既存の知識獲得予測の手法において，Deep Knowledge Tracingが最適であることを述べた後，
各ブロックについて詳述する．
一つ目の要素として，データセットの作成を取り上げ，分析対象とするデータセットと，本研究に適用する上でのデータの要件を説明する．
%データセットが大規模であること，
%数学に関する問題回答ログであること，
%抽出した知識分類と比較可能な，既存の知識分類を有すること
その後，二つ目の要素として，知識獲得予測に基づく問題と知識分類の関係行列の算出を取り上げ，
その方法として，既存のDeep Knowledge Tracingの手法の拡張するモデル設計について述べる．
最後に，三つ目の要素として，知識分類の抽出と検証を取り上げ，
上述の問題と知識分類の関係行列から，知識分類を作成し，既存の知識分類と比較する手法について述べる．


% AUCについて何処かに書く

\vvspace


\section{分析手法全体の流れ}
まず，分析手法全体の流れを説明する．
本研究の手法は，データセットの作成，知識獲得予測に基づく問題と知識分類の関係行列の算出，知識分類の抽出と検証の３つの要素から構成される．


一つ目の要素は，データセットの作成である．
本論文が扱う，生徒の知識獲得予測において，
生徒が知識を獲得しているか否かの評価には，生徒の問題回答ログデータを対象データセットとして用いる．

その際，比較検証に用いるため，
知識獲得の予測に利用できる複数のデータセットを利用し，また，本研究に適用するために，幾つかの条件に基づいて対象データを抽出する．
この条件については後述する．


二つ目の要素は，知識獲得予測に基づく問題と知識分類の関係行列の算出である．
作成したデータセットに対し，知識獲得予測を行う過程で知識分類を学習できる手法を適用し，
問題と知識分類の関係行列を算出する．
手法の基礎となっているのはDeep Knowledge Tracingであり，
この手法が知識分類を学習しながら知識獲得予測を行う上で最適な手法であること，
また，同手法の本研究における拡張方法についても後述する．


三つ目の要素は，知識分類の抽出と検証である．
算出された問題と知識分類の関係行列を離散表現に改めることで，
モデルが学習した知識分類を抽出し，
抽出された分類が紐づく問題の回答傾向の特徴や，既存の知識分類との比較を通じて，抽出された分類を定性的に分析する．
また，知識獲得予測タスクに対して，既存の分類を入力とした場合よりも抽出された分類を入力とした場合のほうが，
高い精度を得られることを示し，生徒の知識獲得を適切に表現する分類が得られたことを定性的に示す．
% 可読性とかの話を何処かに書く


以上が，分析手法全体の流れである．
以降では，
データセット作成におけるデータの要件，
知識獲得予測に用いる手法の基礎，
知識分類を学習させるための拡張，
%問題と知識分類の関係行列の算出方法，
知識分類の抽出と検証
について順に詳述する．
% ３つの要素にきれいに分解する？


\section{データセット作成におけるデータの要件}
本論文が扱う生徒の知識獲得予測においては，
前述の通り，生徒の問題回答ログデータをデータセットとして用いる．
生徒の問題への回答結果は，その問題が問う知識を，生徒が既に獲得しているか否かを表現していると捉えることができるため，
回答結果が正解であれば，該当の知識を既に獲得しており，
回答結果が不正解であれば，該当の知識を未だ獲得していないと捉えることができるからである．

問題回答ログデータから作成するデータセットは，下記の要件を満たす必要がある．
% itemize?
１) データセットが大規模であること
２) 比較検証できるデータセットが複数存在すること
３）問題に既存の知識分類が割り当てられていること

まず，データセットが大規模である必要について説明する．
一般に，深層学習は大量のデータを元に特徴的な表現を抽出するため，
深層学習モデルを十分に学習させるには，大規模なデータが必要である．
データ数が不足すると，データの潜在的な特徴を十分に学習できないことに加え，
汎用性の低い特徴まで過剰に学習してしまう「過学習」に陥りやすくなる．
これは，深層学習モデルの一つであるRNNを活用するDeep Knowledge Tracingについても同様である\cite{piech2015deep}．
したがって，大規模なデータを有することがデータセットの要件の一つとなる．

また，深層学習によって知識獲得の予測を行う本研究においては，単に全体のデータ数が多いだけでなく，
分析対象となる個別の問題や生徒について，十分なデータ数を確保できることが必要である．
例えば，一度しか回答されていない問題については，
その問題の正答や誤答によって，生徒の知識状態がどのように変化するかが観察できないため，分析に適していない．
また，十分な数の生徒のデータがないと，特定の生徒の学習傾向が強く反映され，
より一般的に知識獲得を説明する知識分類を学習できないおそれがある．


次に，比較検証できるデータセットが複数存在する必要について述べる．
本研究で用いる問題回答ログからなるデータセットは，
そのデータセットが提供されるプラットフォームにより，問題を回答している集団や，扱っている教科，内容のレベルなどが異なる．
特定のデータセットのみに対して得られた結果は，そのデータセットの条件においてのみ有効である可能性があり，
一般性のある結果や知見が得られたとは言いにくい．
そのため，本研究では，教科を数学に絞った上で，複数のプラットフォームにおける問題回答ログから複数のデータセットを作成することで，
手法の一般性を検証する．
なお，数学に限らない，他教科への適用可能性についても，第７章？で考察する．


さらに，回答された問題に，既存の知識分類が割り当てられていること必要について述べる．
一般的な知識獲得予測では，問題によって評価される知識を，事前に専門家によってつけられた知識分類に基づいて定義している．
本論文では，この「問題によって評価される知識」を，モデル自身が学習して抽出した知識分類に基づいて評価するように設計している．
%この設計は，専門家による事前の知識分類が，知識獲得を的確に説明できる分類であるという根拠がないという前提に立っている．
この設計は，専門家による事前の知識分類は，生徒や教師にとっての可読性を目的としてつけられたもので，
実際の知識獲得の過程を説明する上で最適化された分類ではないという仮説の上に立ったものである．
本論文では，専門家の事前分類を所与のものとせずに，問題の回答ログデータのみを深層学習に適用することで，
知識獲得の過程を最もよく説明する知識分類を抽出することを目的としている．
その抽出した知識分類の妥当性や性質を比較検証するために，既存の知識分類が存在することが必要である．


% これを最初に持ってくる？
\section{知識獲得予測に用いる手法の基礎}
本研究で用いる手法は，数ある知識獲得予測の手法の中でも，Deep Knowledge Tracing（以下，DKT）を元に設計されている．
DKTを拡張する手法が，本研究の目的を達成する上で最適な手法であることを，以下の二点に基づいて説明する．
1)知識間の関係性が，知識獲得予測の文脈において，定量的に検証されて抽出されるべきこと，
2)知識獲得予測が，複数の知識間の影響関係や，知識獲得の時系列性を考慮して行われるべきこと，


まず，知識間の関係性については，知識獲得予測の過程で抽出されるものと，そうでないものがある．
後者については，
専門家が作成するという手法や，
テキスト解析により概念関係ネットワークを構築するという手法\cite{chen2008mining}がある．
しかし，これらの手法は，
専門家や研究者が立てた仮説に基づいた定性的なものであり，
実際の生徒の学習過程をよく説明するものであるという定量的な根拠はない．

問題回答正誤の分析により知識の構造化を行う方法では，%詳述
2つの問題$i$と$j$の間で問題$i$が正解後と不正解後の問題$j$の正解率の差と着手順序を基に知識は構造化される．
しかし，この手法は2つの問題$i$と$j$の関係性のみを考慮しており，他の問題との関係性は独立だと見なされている．
得られた知識間関係は2つ知識の間についてのものを線形に合算したものであり，
複雑で密接に関係している複数の知識の獲得順序や影響関係を捉えているものではない．

一方で，知識間の関係性の抽出を，知識獲得を予測する過程で行うものは，
生徒の知識状態と行動を元に，知識の獲得を予測しているため，
生徒の学習過程を反映した知識間関係を表現している可能性が高い．

したがって，
知識間関係を定量的に抽出する手法としては，
知識獲得を予測する過程で知識間関係を抽出する手法に絞る．


次に，知識獲得予測については，
複数の知識の影響関係や知識獲得の時系列性を考慮するものと，そうでないものがある．
% BKT的なものとDKT的なものがある
後者については，
複数の知識を独立なものとして，known/unkonwnという状態を遷移するBKTの手法や，
過去の回答の結果をまとめてxxxするPFAの手法などがある．
しかし，BKTの手法は，複数の知識を独立なものとして捉えるため，複数の知識からなる複雑な知識状態を捉えきれず，
また，PFAの手法も，直前の回答も，十分な時間が立った後の回答も，一つの過去の回答として捉えるため，
生徒の時間に沿った知識獲得の状態を，現実的に捉えきれていない．

一方，DKTは，時系列に沿ってRNNの隠れ層を更新することにより，
複数の知識間の影響関係や，知識獲得の時系列性を考慮して知識獲得を予測しているので，
より現実に沿った知識間関係を抽出できる可能性が高い．

現に\cite{piech2015deep}で，
既にDKTによって知識間関係を抽出できることが報告されており，% BKTとかよりいい
複雑で密接に関係している複数の知識の獲得順序や影響関係を捉えている可能性が高く，
DKTを利用することが最適であると考えられる．

% PFAについては述べる必要ないかも
また，PFAとDKTのいずれの手法も知識間関係を考慮して予測に利用しているが，DKTの方が有効性が高いと考える．
なぜなら，
\cite{piech2015deep}では言及されていなかったが，
DKTはPFAの拡張になっているためである．
DKTはRNNを利用しており，
\begin{eqnarray}
{\bf h}_t & = & f({\bf x}_t, {\bf h}_{t-1})\\
{\bf p}_t & = & \sigma({\bf h}_{t-1} \cdot {\bf W}_{hp} + {\bf b}_p)
\end{eqnarray}
で与えられる．
一方でPFAは
\begin{eqnarray}
	p(i, j \in KCs, s, f) & = & \sigma( \beta _j + \sum_{k \in KCs}(\gamma_k s_{i, k} + \rho _k f_{i, k}) )
\end{eqnarray}
で与えられる．
したがって，
\begin{eqnarray}
\label{eq:discussion-func}
	f({\bf x}_t, {\bf h}_{t-1}) &=& {\bf x}_t + {\bf h}_{t-1}\\
	{\bf h}_{0} & = & [0, 0, \cdots , 0]
\end{eqnarray}
とすると，
${\bf h_t}$がこれまでの各問題についての正答回数を表現するベクトルと各問題についての誤答回数を表現するベクトルを結合したベクトルになるが， 
これは，ベクトル${\bf s}$と${\bf f}$を結合したものと同じである．
したがって，
PFAはDKT内部のRNNの繰り返しの部分を表現する関数$f$を式\ref{eq:discussion-func}にした特殊なケースであり，
DKTはPFAの拡張になっている．


\section{知識分類を学習させるための拡張}
本研究のモデルを設計する上で基礎となるDKTを，本研究の目的を達成するために拡張する方法を説明する．


DKTのモデルにおいては，使用するデータは問題回答ログデータであるが，
モデルへの入力は，既存の知識分類に落とし込まれ，どの知識分類に属する問題に回答したかが入力される．
これは，既存の知識分類の中で，生徒がどのように知識獲得をしていくかを予測することを前提にしているためであるが，
この前提は，本研究の，問題の回答のみから，未知の知識分類を学習させるという目的を満たさない．

よって本研究では，モデルへの入力は問題回答のままにとどめ，
生徒が次にどの問題に正解するかを予測する過程において，
生徒の知識状態を，モデル自身が定義した知識空間で解釈させることで，
最終的に，問題回答の正誤予測を最適化するような知識分類を抽出させる．

こうして抽出された知識分類は，結果的に知識獲得の文脈で最適化されていると考えることができ，
既存の知識分類と比較することで，その性質を解釈することができる．


以下では，具体的なモデルの設計について述べる．
まず，DKTのモデル構造と大きく異なる点は，
DKTでは入力が直接隠れ層へ伝達されるのに対し，
本研究のモデルは，まず抽出目的のタグ空間への写像を行う．
ここで言うタグ空間とは，問題回答の正誤からモデルが解釈した，その生徒の知識状態を反映した空間である．
モデル自身が定義した，問題とタグの関係性に基づき，
問題に正答すると，問題と関係性が強いタグほど理解度が高くなるように知識状態が変化し，
逆に誤答すると，問題と関係性の強いタグほど理解度が低くなるように知識状態が変化するよう設計されている．
知識獲得予測を最適化する過程で，モデル自身が問題とタグの関係性を学習することで，
最終的に，知識獲得を最もよく説明する，問題とタグの関係性の行列を抽出することができる．
% オートエンコーダ部分のことも盛り込む
% 詳しい考察は考察に書く？完全な事前学習ではなくRNNの中で抽出した分類を使ったほうが精度が良い＝単純な問題と低次元空間の対応だけではうまく行かなくて，時系列性を反映する何かが制約に入っていないとだめ


\section{知識分類の抽出と検証}
知識獲得予測において抽出された，問題と知識分類の関係行列から，
実際に知識分類を抽出し，既存の知識分類と比較する手法について説明する．

まず，知識獲得予測において抽出された問題と知識分類の関係行列は，
０から１の値を取る連続値表現であるため，そのままでは問題がどの知識分類に紐づくかを特定することはできない．
そのため，何らかの方法で，この行列を０か１の２値を取る離散表現に改める必要がある．
離散化の方法としては，各問題に対して最も関係性の強い知識分類のみを１とし，他を０にする方法や，
行列全体で０から１の間の特定の閾値を定め，その閾値を境に０か１にする方法，両者を組み合わせる方法など，
様々な方法が考えられる．
各方法によって，抽出された知識分類の性質の異なる解釈をすることが可能だが，
本研究では，知識獲得予測に用いた際に最も良い精度で予測できる分類を，
知識獲得の遷移を最もよく説明する分類として見なし，解釈する．
検証の方法としては，離散化された知識分類に基づいて問題を知識分類に落とし込んで入力とし，
既存手法と同様の予測を行うことで，公平な比較を行う．

結果的に，いずれのデータセットにおいても，
各問題に対して最も関係性の強い知識分類のみを１とし，他を０にする方法が，
最も高い精度で知識獲得を予測できることを確認した．
そのため，この手法に基づいて問題と知識分類の関係行列を離散化し，
抽出された知識分類を既存の知識分類と比較する．


次に，抽出された知識分類と既存の知識分類の比較手法について述べる．
抽出された知識分類は，知識獲得予測の精度としては優れていることは定量的に検証できるものの，
どのような性質のものかという解釈ができなければ，教育現場における実用性を担保することができない．
そのため，抽出された知識分類と既存の知識分類を比較することで，その性質を解釈する必要がある．
具体的には，抽出した知識分類と，それが紐づく問題に元々紐付けられていた知識分類を照らし合わせることで，
既存の知識分類と被っている領域や，異なる領域を観察し，
抽出した知識分類が持つ階層性や，知識獲得予測を最適化する上で効いているとかんがえられる要素を考察する．
また，抽出された知識分類が紐づく問題の正答率や，回答される順序に注目することで，知識分類の階層性や難易度に関する考察も行う．


\vvspace
以上，分析手法について述べた．
次章では，実験で利用するデータセットについて述べる．

